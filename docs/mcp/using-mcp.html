<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>使用 MCP - Claude Code 中文文档</title>
  <link rel="stylesheet" href="../../assets/css/style.css">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet">
</head>
<body>
  <aside class="sidebar">
    <div class="brand">
      <a href="../../index.html" style="text-decoration: none; color: inherit;">Claude Code 中文文档</a>
    </div>
    <input class="search-input" type="text" placeholder="搜索文档..." id="searchInput">
    <nav class="doc-nav">
      <details class="nav-section">
        <summary>快速开始</summary>
        <ul>
          <li><a href="../getting-started/installation.html">安装</a></li>
          <li><a href="../getting-started/first-steps.html">第一步</a></li>
        </ul>
      </details>
      <details class="nav-section">
        <summary>概念</summary>
        <ul>
          <li><a href="../concepts/overview.html">概述</a></li>
          <li><a href="../concepts/session-management.html">会话管理</a></li>
        </ul>
      </details>
      <details class="nav-section">
        <summary>命令</summary>
        <ul>
          <li><a href="../commands/built-in.html">内置命令</a></li>
          <li><a href="../commands/slash-commands.html">斜杠命令</a></li>
        </ul>
      </details>
      <details class="nav-section">
        <summary>技能</summary>
        <ul>
          <li><a href="../skills/creating-skills.html">创建技能</a></li>
          <li><a href="../skills/skill-reference.html">技能参考</a></li>
        </ul>
      </details>
      <details class="nav-section" open>
        <summary>MCP</summary>
        <ul>
          <li><a href="what-is-mcp.html">什么是 MCP</a></li>
          <li><a href="using-mcp.html" style="color: var(--color-link);">使用 MCP</a></li>
        </ul>
      </details>
    </nav>
  </aside>

  <main class="content">
    <article class="doc-article">
      <div class="breadcrumbs">首页 > MCP</div>

      <h1>使用 MCP</h1>

      <p>学习如何配置和使用 MCP 服务器来扩展 Claude Code 的功能。</p>

      <h2>快速开始</h2>

      <h3>步骤 1：创建 MCP 服务器</h3>

      <p>创建 <code>mcp_servers/weather.py</code>：</p>

      <pre><code class="language-python">#!/usr/bin/env python3
import asyncio
from mcp import Server

server = Server("weather-server")

@server.tool()
async def get_weather(city: str) -> str:
    """获取指定城市的天气信息"""
    # 这里可以调用真实的天气 API
    weather_data = {
        "北京": "晴天，15°C",
        "上海": "多云，20°C",
        "深圳": "阴天，25°C"
    }
    return weather_data.get(city, f"{city} 的天气数据不可用")

if __name__ == "__main__":
    server.run()</code></pre>

      <h3>步骤 2：配置服务器</h3>

      <p>在项目根目录创建 <code>.claude/config.json</code>：</p>

      <pre><code class="language-json">{
  "mcpServers": {
    "weather": {
      "command": "python",
      "args": ["mcp_servers/weather.py"]
    }
  }
}</code></pre>

      <h3>步骤 3：启动 Claude Code</h3>

      <pre><code class="language-bash">claude</code></pre>

      <h3>步骤 4：使用 MCP 工具</h3>

      <pre><code class="language-bash">> 请帮我查询北京的天气

# Claude 会调用 get_weather 工具
# 北京 晴天，15°C</code></pre>

      <h2>高级配置</h2>

      <h3>环境变量</h3>

      <p>为 MCP 服务器传递环境变量：</p>

      <pre><code class="language-json">{
  "mcpServers": {
    "database": {
      "command": "python",
      "args": ["mcp_servers/database.py"],
      "env": {
        "DB_HOST": "localhost",
        "DB_PORT": "5432",
        "DB_NAME": "mydb",
        "DB_USER": "admin",
        "DB_PASSWORD": "${DB_PASSWORD}"
      }
    }
  }
}</code></pre>

      <h3>多服务器配置</h3>

      <pre><code class="language-json">{
  "mcpServers": {
    "weather": {
      "command": "python",
      "args": ["mcp_servers/weather.py"]
    },
    "database": {
      "command": "python",
      "args": ["mcp_servers/database.py"]
    },
    "api": {
      "command": "node",
      "args": ["mcp_servers/api.js"]
    }
  }
}</code></pre>

      <h2>常见 MCP 服务器</h2>

      <h3>数据库服务器</h3>

      <pre><code class="language-python">@server.tool()
async def query(sql: str) -> list:
    """执行 SQL 查询"""
    import sqlite3
    conn = sqlite3.connect('database.db')
    cursor = conn.cursor()
    cursor.execute(sql)
    results = cursor.fetchall()
    conn.close()
    return results</code></pre>

      <h3>文件系统服务器</h3>

      <pre><code class="language-python">@server.tool()
async def read_file(path: str) -> str:
    """读取文件内容"""
    with open(path, 'r') as f:
        return f.read()

@server.tool()
async def list_files(dir: str) -> list:
    """列出目录文件"""
    import os
    return os.listdir(dir)</code></pre>

      <h3>HTTP API 服务器</h3>

      <pre><code class="language-python">@server.tool()
async def fetch_api(url: str, method: str = "GET") -> dict:
    """调用 HTTP API"""
    import requests
    response = requests.request(method, url)
    return response.json()</code></pre>

      <h2>调试 MCP 服务器</h2>

      <h3>查看服务器日志</h3>

      <pre><code class="language-bash"># 启动时启用详细日志
claude --log-level debug</code></pre>

      <h3>手动测试服务器</h3>

      <pre><code class="language-bash"># 直接运行 MCP 服务器
python mcp_servers/weather.py

# 测试工具调用
echo '{"jsonrpc":"2.0","method":"tools/call","params":{"name":"get_weather","arguments":{"city":"北京"}},"id":1}' | python mcp_servers/weather.py</code></pre>

      <h2>最佳实践</h2>

      <ol>
        <li><strong>错误处理</strong> - 始终处理可能的错误和异常</li>
        <li><strong>输入验证</strong> - 验证所有参数</li>
        <li><strong>超时设置</strong> - 为长时间运行的操作设置超时</li>
        <li><strong>资源清理</strong> - 确保关闭连接和释放资源</li>
        <li><strong>日志记录</strong> - 记录重要操作以便调试</li>
      </ol>

      <h2>故障排除</h2>

      <h3>服务器启动失败</h3>
      <ul>
        <li>检查命令路径是否正确</li>
        <li>确认 Python/Node.js 已安装</li>
        <li>查看服务器脚本的权限</li>
      </ul>

      <h3>工具调用失败</h3>
      <ul>
        <li>确认工具已正确注册</li>
        <li>检查参数类型是否匹配</li>
        <li>查看服务器日志获取错误信息</li>
      </ul>

      <h2>示例项目</h2>

      <p>查看官方 MCP 服务器示例：</p>
      <ul>
        <li><a href="https://github.com/modelcontextprotocol/servers" target="_blank">MCP 官方服务器仓库</a></li>
        <li><a href="https://github.com/modelcontextprotocol/create-mcp-server" target="_blank">MCP 服务器生成器</a></li>
      </ul>

      <h2>相关文档</h2>

      <ul>
        <li><a href="what-is-mcp.html">什么是 MCP</a></li>
        <li><a href="../skills/creating-skills.html">创建技能</a></li>
        <li><a href="../concepts/overview.html">概念概述</a></li>
      </ul>

      <div class="doc-nav-footer">
        <a class="prev-link" href="what-is-mcp.html">← 什么是 MCP</a>
        <a class="next-link" href="#">← 返回顶部</a>
      </div>
    </article>
  </main>

  <div class="search-results" id="searchResults"></div>

  <script src="../../assets/js/search.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-bash.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-typescript.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-json.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-markdown.min.js"></script>
</body>
</html>
