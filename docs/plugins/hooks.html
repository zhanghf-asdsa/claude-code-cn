<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>é’©å­ï¼ˆHooksï¼‰- Claude Code ä¸­æ–‡æ–‡æ¡£</title>
  <link rel="stylesheet" href="../../assets/css/style.css">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet">
</head>
<body>
  <aside class="sidebar">
    <div class="brand"><a href="../../index.html" style="text-decoration: none; color: inherit;">Claude Code ä¸­æ–‡æ–‡æ¡£</a></div>
    <input class="search-input" type="text" placeholder="æœç´¢æ–‡æ¡£..." id="searchInput">
    <nav class="doc-nav">
      <details class="nav-section"><summary>å¿«é€Ÿå¼€å§‹</summary><ul><li><a href="../getting-started/installation.html">å®‰è£…</a></li><li><a href="../getting-started/first-steps.html">ç¬¬ä¸€æ­¥</a></li></ul></details>
      <details class="nav-section"><summary>æ¦‚å¿µ</summary><ul><li><a href="../concepts/overview.html">æ¦‚è¿°</a></li><li><a href="../concepts/session-management.html">ä¼šè¯ç®¡ç†</a></li></ul></details>
      <details class="nav-section"><summary>å‘½ä»¤</summary><ul><li><a href="../commands/built-in.html">å†…ç½®å‘½ä»¤</a></li><li><a href="../commands/slash-commands.html">æ–œæ å‘½ä»¤</a></li></ul></details>
      <details class="nav-section"><summary>æŠ€èƒ½</summary><ul><li><a href="../skills/creating-skills.html">åˆ›å»ºæŠ€èƒ½</a></li><li><a href="../skills/skill-reference.html">æŠ€èƒ½å‚è€ƒ</a></li></ul></details>
      <details class="nav-section"><summary>MCP</summary><ul><li><a href="../mcp/what-is-mcp.html">ä»€ä¹ˆæ˜¯ MCP</a></li><li><a href="../mcp/using-mcp.html">ä½¿ç”¨ MCP</a></li></ul></details>
      <details class="nav-section" open><summary>æ’ä»¶</summary><ul><li><a href="overview.html">æ¦‚è¿°</a></li><li><a href="plugin-structure.html">æ’ä»¶ç»“æ„</a></li><li><a href="slash-commands.html">æ–œæ å‘½ä»¤</a></li><li><a href="agents.html">ä»£ç†ï¼ˆAgentsï¼‰</a></li><li><a href="skills.html">æŠ€èƒ½ï¼ˆSkillsï¼‰</a></li><li><a href="hooks.html" style="color: var(--color-link);">é’©å­ï¼ˆHooksï¼‰</a></li></ul></details>
    </nav>
  </aside>

  <main class="content">
    <article class="doc-article">
      <div class="breadcrumbs">é¦–é¡µ > æ’ä»¶</div>
      <h1>é’©å­ï¼ˆHooksï¼‰</h1>
      <p>é’©å­ï¼ˆHooksï¼‰å…è®¸æ‚¨åœ¨ Claude Code çš„ç‰¹å®šäº‹ä»¶å‘ç”Ÿæ—¶æ‰§è¡Œè‡ªå®šä¹‰è„šæœ¬ï¼Œå®ç°è‡ªåŠ¨åŒ–å·¥ä½œæµç¨‹å’Œè‡ªå®šä¹‰è¡Œä¸ºã€‚</p>

      <h2>ä»€ä¹ˆæ˜¯é’©å­ï¼Ÿ</h2>
      <p>é’©å­æ˜¯äº‹ä»¶é©±åŠ¨çš„è„šæœ¬ï¼Œåœ¨ç‰¹å®šäº‹ä»¶å‘ç”Ÿæ—¶è‡ªåŠ¨è§¦å‘ï¼š</p>
      <ul>
        <li><strong>å·¥å…·ä½¿ç”¨å‰å</strong> - éªŒè¯æˆ–ä¿®æ”¹æ“ä½œ</li>
        <li><strong>ä¼šè¯å¼€å§‹/ç»“æŸ</strong> - åˆå§‹åŒ–ç¯å¢ƒæˆ–æ¸…ç†èµ„æº</li>
        <li><strong>ç”¨æˆ·æäº¤æ—¶</strong> - éªŒè¯æˆ–å¢å¼ºè¾“å…¥</li>
        <li><strong>ä»£ç†åˆ‡æ¢æ—¶</strong> - åŒæ­¥çŠ¶æ€æˆ–æ—¥å¿—è®°å½•</li>
      </ul>

      <h2>å¯ç”¨é’©å­ç±»å‹</h2>

      <h3>PreToolUse</h3>
      <p>åœ¨ä»»ä½•å·¥å…·ä½¿ç”¨ä¹‹å‰è§¦å‘ã€‚é€‚ç”¨äºï¼š</p>
      <ul>
        <li>éªŒè¯æ“ä½œå®‰å…¨æ€§</li>
        <li>é™åˆ¶æ•æ„Ÿå‘½ä»¤</li>
        <li>è®°å½•æ“ä½œæ—¥å¿—</li>
        <li>ä¿®æ”¹å·¥å…·å‚æ•°</li>
      </ul>

      <h3>PostToolUse</h3>
      <p>åœ¨ä»»ä½•å·¥å…·ä½¿ç”¨ä¹‹åè§¦å‘ã€‚é€‚ç”¨äºï¼š</p>
      <ul>
        <li>å¤„ç†å·¥å…·è¾“å‡º</li>
        <li>è§¦å‘åç»­æ“ä½œ</li>
        <li>æ›´æ–°çŠ¶æ€æ–‡ä»¶</li>
        <li>å‘é€é€šçŸ¥</li>
      </ul>

      <h3>SessionStart</h3>
      <p>åœ¨ä¼šè¯å¼€å§‹æ—¶è§¦å‘ã€‚é€‚ç”¨äºï¼š</p>
      <ul>
        <li>åˆå§‹åŒ–å¼€å‘ç¯å¢ƒ</li>
        <li>åŠ è½½é¡¹ç›®é…ç½®</li>
        <li>æ£€æŸ¥ä¾èµ–æ›´æ–°</li>
        <li>æ˜¾ç¤ºæ¬¢è¿ä¿¡æ¯</li>
      </ul>

      <h3>Stop</h3>
      <p>åœ¨ä¼šè¯ç»“æŸæ—¶è§¦å‘ã€‚é€‚ç”¨äºï¼š</p>
      <ul>
        <li>æ¸…ç†ä¸´æ—¶æ–‡ä»¶</li>
        <li>ä¿å­˜ä¼šè¯çŠ¶æ€</li>
        <li>ç”Ÿæˆä¼šè¯æ‘˜è¦</li>
        <li>å…³é—­è¿æ¥</li>
      </ul>

      <h3>UserPromptSubmit</h3>
      <p>åœ¨ç”¨æˆ·æäº¤æç¤ºæ—¶è§¦å‘ã€‚é€‚ç”¨äºï¼š</p>
      <ul>
        <li>éªŒè¯ç”¨æˆ·è¾“å…¥</li>
        <li>å¢å¼ºç”¨æˆ·è¯·æ±‚</li>
        <li>è®°å½•æŸ¥è¯¢æ—¥å¿—</li>
        <li>è¿‡æ»¤æ•æ„Ÿå†…å®¹</li>
      </ul>

      <h3>AgentSwitch</h3>
      <p>åœ¨ä»£ç†åˆ‡æ¢æ—¶è§¦å‘ã€‚é€‚ç”¨äºï¼š</p>
      <ul>
        <li>åŒæ­¥ä»£ç†çŠ¶æ€</li>
        <li>è®°å½•åˆ‡æ¢å†å²</li>
        <li>ä¼ é€’ä¸Šä¸‹æ–‡</li>
      </ul>

      <h2>é…ç½®é’©å­</h2>
      <p>åœ¨æ’ä»¶çš„ <code>hooks/</code> ç›®å½•åˆ›å»º <code>hooks.json</code>ï¼š</p>

      <pre><code class="language-json">{
  "description": "æˆ‘çš„è‡ªå®šä¹‰é’©å­é…ç½®",
  "hooks": {
    "PreToolUse": [
      {
        "matcher": "Bash",
        "hooks": [
          {
            "type": "command",
            "command": "python3 hooks/validate-bash.py",
            "timeout": 10
          }
        ]
      }
    ],
    "PostToolUse": [
      {
        "matcher": "Write",
        "hooks": [
          {
            "type": "command",
            "command": "bash hooks/format-check.sh"
          }
        ]
      }
    ],
    "SessionStart": [
      {
        "hooks": [
          {
            "type": "command",
            "command": "bash hooks/init-session.sh"
          }
        ]
      }
    ]
  }
}</code></pre>

      <h2>é’©å­é…ç½®å­—æ®µ</h2>
      <table>
        <thead>
          <tr>
            <th>å­—æ®µ</th>
            <th>ç±»å‹</th>
            <th>æè¿°</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><code>matcher</code></td>
            <td>string</td>
            <td>åŒ¹é…çš„å·¥å…·åç§°ï¼ˆå¯é€‰ï¼Œä¸åŒ¹é…åˆ™é€‚ç”¨äºæ‰€æœ‰å·¥å…·ï¼‰</td>
          </tr>
          <tr>
            <td><code>type</code></td>
            <td>string</td>
            <td>é’©å­ç±»å‹ï¼šcommandã€builtin</td>
          </tr>
          <tr>
            <td><code>command</code></td>
            <td>string</td>
            <td>è¦æ‰§è¡Œçš„å‘½ä»¤</td>
          </tr>
          <tr>
            <td><code>timeout</code></td>
            <td>number</td>
            <td>è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰</td>
          </tr>
        </tbody>
      </table>

      <h2>é’©å­è„šæœ¬</h2>
      <p>é’©å­è„šæœ¬æ¥æ”¶ç¯å¢ƒå˜é‡ä½œä¸ºè¾“å…¥ï¼š</p>

      <h3>å¯ç”¨ç¯å¢ƒå˜é‡</h3>
      <table>
        <thead>
          <tr>
            <th>å˜é‡</th>
            <th>æè¿°</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><code>CLAUDE_HOOK_TYPE</code></td>
            <td>é’©å­ç±»å‹åç§°</td>
          </tr>
          <tr>
            <td><code>CLAUDE_TOOL_NAME</code></td>
            <td>è¢«è°ƒç”¨çš„å·¥å…·åç§°</td>
          </tr>
          <tr>
            <td><code>CLAUDE_TOOL_INPUT</code></td>
            <td>å·¥å…·è¾“å…¥çš„ JSON å­—ç¬¦ä¸²</td>
          </tr>
          <tr>
            <td><code>CLAUDE_PROJECT_DIR</code></td>
            <td>é¡¹ç›®ç›®å½•è·¯å¾„</td>
          </tr>
          <tr>
            <td><code>CLAUDE_PLUGIN_ROOT</code></td>
            <td>æ’ä»¶æ ¹ç›®å½•</td>
          </tr>
        </tbody>
      </table>

      <h2>é’©å­ç¤ºä¾‹</h2>

      <h3>PreToolUse: é™åˆ¶å±é™©å‘½ä»¤</h3>
      <pre><code class="language-python">#!/usr/bin/env python3
import json
import os
import sys

def validate_bash_command():
    tool_input = os.environ.get('CLAUDE_TOOL_INPUT', '{}')
    data = json.loads(tool_input)
    command = data.get('command', '')

    # é˜»æ­¢å±é™©å‘½ä»¤
    dangerous = ['rm -rf', 'format', 'mkfs']
    if any(danger in command for danger in dangerous):
        print(f"Error: Dangerous command blocked: {command}", file=sys.stderr)
        sys.exit(1)

    sys.exit(0)

if __name__ == '__main__':
    validate_bash_command()</code></pre>

      <h3>PostToolUse: è‡ªåŠ¨æ ¼å¼åŒ–</h3>
      <pre><code class="language-bash">#!/bin/bash
# hooks/format-code.sh

FILE_PATH=$(echo "$CLAUDE_TOOL_INPUT" | jq -r '.file_path')

# æ£€æŸ¥æ–‡ä»¶æ‰©å±•å
if [[ "$FILE_PATH" =~ \.(js|ts|jsx|tsx)$ ]]; then
    # è¿è¡Œ Prettier
    npx prettier --write "$FILE_PATH"
elif [[ "$FILE_PATH" =~ \.py$ ]]; then
    # è¿è¡Œ Black
    black "$FILE_PATH"
fi

exit 0</code></pre>

      <h3>SessionStart: åˆå§‹åŒ–ç¯å¢ƒ</h3>
      <pre><code class="language-bash">#!/bin/bash
# hooks/init-session.sh

echo "ğŸš€ åˆå§‹åŒ–å¼€å‘ç¯å¢ƒ..."

# æ£€æŸ¥ä¾èµ–
if [ -f "package.json" ]; then
    echo "æ£€æŸ¥ Node.js ä¾èµ–..."
    npm outdated || true
fi

# æ£€æŸ¥ Git çŠ¶æ€
if [ -d ".git" ]; then
    BRANCH=$(git branch --show-current)
    echo "å½“å‰åˆ†æ”¯: $BRANCH"
fi

# æ˜¾ç¤ºé¡¹ç›®ä¿¡æ¯
echo "é¡¹ç›®ç›®å½•: $CLAUDE_PROJECT_DIR"

exit 0</code></pre>

      <h3>UserPromptSubmit: è¾“å…¥éªŒè¯</h3>
      <pre><code class="language-python">#!/usr/bin/env python3
import os
import sys

def validate_user_input():
    prompt = os.environ.get('CLAUDE_USER_PROMPT', '')

    # æ£€æŸ¥æ•æ„Ÿå†…å®¹
    sensitive_patterns = ['password', 'api_key', 'secret']
    for pattern in sensitive_patterns:
        if pattern in prompt.lower():
            print(f"Warning: Sensitive keyword detected: {pattern}", file=sys.stderr)
            # å¯ä»¥é€‰æ‹©é˜»æ­¢æˆ–åªæ˜¯è­¦å‘Š
            # sys.exit(1)

    sys.exit(0)

if __name__ == '__main__':
    validate_user_input()</code></pre>

      <h2>é’©å­è¾“å‡º</h2>
      <p>é’©å­è„šæœ¬é€šè¿‡ä»¥ä¸‹æ–¹å¼å½±å“æ‰§è¡Œæµç¨‹ï¼š</p>

      <h3>æˆåŠŸï¼ˆé€€å‡ºç  0ï¼‰</h3>
      <p>å…è®¸æ“ä½œç»§ç»­æ‰§è¡Œã€‚</p>

      <h3>é˜»æ­¢ï¼ˆé€€å‡ºç é 0ï¼‰</h3>
      <p>å¯¹äº PreToolUse é’©å­ï¼Œä¼šé˜»æ­¢å·¥å…·æ‰§è¡Œå¹¶æ˜¾ç¤ºé”™è¯¯ï¼š</p>
      <pre><code class="language-bash">#!/bin/bash
# é˜»æ­¢å†™å…¥ node_modules ç›®å½•

FILE_PATH=$(echo "$CLAUDE_TOOL_INPUT" | jq -r '.file_path')

if [[ "$FILE_PATH" == *"/node_modules/"* ]]; then
    echo "Error: Cannot modify files in node_modules" >&2
    exit 1
fi

exit 0</code></pre>

      <h3>ä¿®æ”¹å·¥å…·è¾“å…¥</h3>
      <p>é’©å­å¯ä»¥è¾“å‡º JSON æ¥ä¿®æ”¹å·¥å…·å‚æ•°ï¼š</p>
      <pre><code class="language-python">#!/usr/bin/env python3
import json
import os

def modify_tool_input():
    tool_input = os.environ.get('CLAUDE_TOOL_INPUT', '{}')
    data = json.loads(tool_input)

    # ä¿®æ”¹è¾“å…¥
    if 'max_tokens' not in data:
        data['max_tokens'] = 4000

    # è¾“å‡ºä¿®æ”¹åçš„è¾“å…¥
    print(json.dumps(data))

if __name__ == '__main__':
    modify_tool_input()</code></pre>

      <h2>æœ€ä½³å®è·µ</h2>

      <ol>
        <li><strong>å¿«é€Ÿæ‰§è¡Œ</strong> - é’©å­åº”å°½å¿«å®Œæˆï¼Œè®¾ç½®åˆç†çš„è¶…æ—¶</li>
        <li><strong>é”™è¯¯å¤„ç†</strong> - æ­£ç¡®å¤„ç†å¼‚å¸¸æƒ…å†µ</li>
        <li><strong>æ¸…æ™°æ—¥å¿—</strong> - ä½¿ç”¨ stderr è¾“å‡ºé”™è¯¯ä¿¡æ¯</li>
        <li><strong>å¹‚ç­‰æ€§</strong> - é’©å­å¯ä»¥å®‰å…¨åœ°é‡å¤æ‰§è¡Œ</li>
        <li><strong>æ–‡æ¡£å®Œå–„</strong> - è®°å½•é’©å­çš„ç”¨é€”å’Œé…ç½®æ–¹å¼</li>
      </ol>

      <h2>ç›¸å…³æ–‡æ¡£</h2>

      <ul>
        <li><a href="overview.html">æ’ä»¶æ¦‚è¿°</a></li>
        <li><a href="plugin-structure.html">æ’ä»¶ç»“æ„</a></li>
        <li><a href="slash-commands.html">æ–œæ å‘½ä»¤</a></li>
        <li><a href="agents.html">ä»£ç†å¼€å‘</a></li>
      </ul>

      <div class="doc-nav-footer">
        <a class="prev-link" href="skills.html">â† æŠ€èƒ½ï¼ˆSkillsï¼‰</a>
      </div>
    </article>
  </main>

  <script src="../../assets/js/search.js"></script>
</body>
</html>
